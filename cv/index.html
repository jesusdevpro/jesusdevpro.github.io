<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CV Studio Pro v4</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='25' fill='%23007AFF'/><path d='M30 35h40M30 50h40M30 65h25' stroke='white' stroke-width='8' stroke-linecap='round'/></svg>">
    <link rel="manifest" id="pwa-manifest">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { --primary: #007AFF; --dark: #1C1C1E; --bg: #F2F2F7; --card: #FFFFFF; }
        * { box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; }
        body { background-color: var(--bg); margin: 0; padding: 15px; color: var(--dark); display: flex; flex-direction: column; align-items: center; }
        .app-container { width: 100%; max-width: 600px; padding-bottom: 120px; }
        .card { background: var(--card); border-radius: 20px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.05); }
        .card h3 { margin-top: 0; font-size: 1.1rem; color: var(--primary); border-bottom: 1px solid #F2F2F7; padding-bottom: 10px; }
        label { font-size: 0.8rem; color: #8E8E93; margin-left: 5px; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #E5E5EA; border-radius: 10px; font-size: 16px; background: #F9F9FB; }
        .btn-add { background: #F2F2F7; color: var(--primary); border: 2px dashed #D1D1D6; width: 100%; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; }
        .item-row { background: #F9F9FB; padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin: 8px 0; border-left: 4px solid var(--primary); }
        .footer-actions { position: fixed; bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 15px; border-radius: 20px; box-shadow: 0 -5px 25px rgba(0,0,0,0.1); width: calc(100% - 30px); max-width: 570px; z-index: 1000; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: 700; cursor: pointer; }
        .btn-pdf { background: var(--dark); }
        .preview-img { width: 60px; height: 60px; object-fit: cover; border-radius: 10px; border: 1px solid #ddd; }
        
        /* Oculto para exportaci√≥n */
        #pdf-render { display: none; background: white; padding: 40px; color: black; }
        .pdf-section { border-bottom: 2px solid var(--primary); color: var(--primary); font-weight: bold; text-transform: uppercase; margin-top: 20px; padding-bottom: 5px; }
    </style>
</head>
<body>

<div class="app-container">
    <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="color: var(--primary); margin:0;">CV Studio Pro</h1>
    </div>

    <div class="card">
        <h3>üë§ Datos Personales</h3>
        <input type="text" id="nombre" placeholder="Nombre Completo">
        <input type="text" id="cedula" placeholder="C√©dula de Identidad (V-00.000.000)">
        
        <label>Fecha de Nacimiento:</label>
        <input type="date" id="fecha_nacimiento">
        
        <input type="text" id="cargo" placeholder="Profesi√≥n o T√≠tulo">
        <input type="text" id="telefono" placeholder="üì± Tel√©fono">
        <input type="text" id="ubicacion" placeholder="üìç Ciudad, Pa√≠s">
        <input type="text" id="email" placeholder="‚úâÔ∏è Correo">
    </div>

    <div class="card">
        <h3>üìù Resumen Profesional</h3>
        <textarea id="perfil" rows="3" placeholder="Describe tu perfil y logros principales..."></textarea>
    </div>

    <div class="card">
        <h3>üíº Experiencia Laboral</h3>
        <div id="lista-exp"></div>
        <button class="btn-add" onclick="modalExp()">+ A√±adir Cargo</button>
    </div>

    <div class="card">
        <h3>üéì Educaci√≥n</h3>
        <div id="lista-edu"></div>
        <button class="btn-add" onclick="modalEdu()">+ A√±adir Educaci√≥n</button>
    </div>

    <div class="card">
        <h3>üìÇ Anexos y Documentos</h3>
        <input type="file" id="input-anexos" accept="image/*" multiple onchange="manejarAnexos(this)" style="display: none;">
        <button class="btn-add" onclick="document.getElementById('input-anexos').click()">üì∑ Subir T√≠tulos o Fotos</button>
        <div id="preview-anexos" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;"></div>
    </div>

    <div style="text-align: center; margin-bottom: 25px;">
        <p style="color: #8E8E93;">Desarrollado por: jesus.rivero86@gmail.com</p>
    </div>

    <div class="footer-actions">
        <button class="btn-main" onclick="generarWord()">Bajar Word</button>
        <button class="btn-main btn-pdf" onclick="generarPDF()" id="miBoton" disabled>Bajar PDF</button>
    </div>
</div>

<div id="pdf-render"><div id="pdf-content"></div></div>
    
    <script>
        const boton = document.getElementById("miBoton");
        const mensaje = document.getElementById("mensaje");
        // Desactivar el bot√≥n y mostrar el mensaje
        boton.disabled = true;
        mensaje.textContent = "No disponible";
    </script>
    
<script>
    let cv = { exp: [], edu: [], anexos: [] };
    const { Document, Packer, Paragraph, TextRun, AlignmentType, ImageRun, BorderStyle, PageBreak } = docx;

    // L√≥gica de UI y Modales (Manteniendo tu estructura anterior)
    const months = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
    const getYears = () => {
        let years = "";
        for(let i = new Date().getFullYear(); i >= 1970; i--) years += `<option value="${i}">${i}</option>`;
        return years;
    };

    async function modalExp() {
        const { value: v } = await Swal.fire({
            title: 'Detalles del Puesto',
            html: `
                <input id="sw-emp" class="swal2-input" placeholder="Empresa">
                <input id="sw-car" class="swal2-input" placeholder="Cargo">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-top:10px;">
                    <select id="sw-m1" class="swal2-input">${months.map(m=>`<option>${m}</option>`)}</select>
                    <select id="sw-a1" class="swal2-input">${getYears()}</select>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">
                    <select id="sw-m2" class="swal2-input"><option value="Presente">Presente</option>${months.map(m=>`<option>${m}</option>`)}</select>
                    <select id="sw-a2" class="swal2-input"><option value="">-</option>${getYears()}</select>
                </div>
                <textarea id="sw-tar" class="swal2-textarea" placeholder="Descripci√≥n..."></textarea>
            `,
            preConfirm: () => {
                const fin = document.getElementById('sw-m2').value === 'Presente' ? 'Actualidad' : `${document.getElementById('sw-m2').value} ${document.getElementById('sw-a2').value}`;
                return { emp: document.getElementById('sw-emp').value, car: document.getElementById('sw-car').value, periodo: `${document.getElementById('sw-m1').value} ${document.getElementById('sw-a1').value} ‚Äì ${fin}`, tar: document.getElementById('sw-tar').value };
            }
        });
        if (v && v.emp) { cv.exp.push(v); updateUI('lista-exp', cv.exp, 'car'); }
    }

    async function modalEdu() {
        const { value: v } = await Swal.fire({
            title: 'Educaci√≥n',
            html: `<input id="sw-tit" class="swal2-input" placeholder="T√≠tulo"><input id="sw-uni" class="swal2-input" placeholder="Instituci√≥n"><select id="sw-ano" class="swal2-input">${getYears()}</select>`,
            preConfirm: () => ({ tit: document.getElementById('sw-tit').value, uni: document.getElementById('sw-uni').value, fec: document.getElementById('sw-ano').value })
        });
        if (v && v.tit) { cv.edu.push(v); updateUI('lista-edu', cv.edu, 'tit'); }
    }

    function manejarAnexos(input) {
        Array.from(input.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => { cv.anexos.push(e.target.result); renderAnexos(); };
            reader.readAsDataURL(file);
        });
    }

    function renderAnexos() {
        document.getElementById('preview-anexos').innerHTML = cv.anexos.map((src, i) => `
            <div style="position: relative;">
                <img src="${src}" class="preview-img">
                <span onclick="cv.anexos.splice(${i},1); renderAnexos()" style="position:absolute; top:-5px; right:-5px; background:red; color:white; border-radius:50%; width:20px; height:20px; font-size:12px; text-align:center; cursor:pointer;">√ó</span>
            </div>
        `).join('');
    }

    function updateUI(id, arr, key) {
        document.getElementById(id).innerHTML = arr.map(i => `<div class="item-row"><span>${i[key]}</span></div>`).join('');
    }

    // --- WORD ---
    async function generarWord() {
        Swal.fire({ title: 'Creando Word...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
        const children = [
            new Paragraph({ children: [new TextRun({ text: document.getElementById('nombre').value.toUpperCase(), bold: true, size: 44 })], alignment: AlignmentType.CENTER }),
            new Paragraph({ children: [new TextRun({ text: `C.I: ${document.getElementById('cedula').value} | F. Nac: ${document.getElementById('fecha_nacimiento').value}`, size: 18, color: "444444" })], alignment: AlignmentType.CENTER }),
            new Paragraph({ children: [new TextRun({ text: document.getElementById('cargo').value.toUpperCase(), size: 24, color: "666666" })], alignment: AlignmentType.CENTER, spacing: { after: 200 } }),
            new Paragraph({ children: [new TextRun({ text: `${document.getElementById('telefono').value} | ${document.getElementById('email').value} | ${document.getElementById('ubicacion').value}`, size: 18 })], alignment: AlignmentType.CENTER, spacing: { after: 400 } }),
            
            ...createHeader("PERFIL"),
            new Paragraph({ children: [new TextRun({ text: document.getElementById('perfil').value, size: 21 })], spacing: { after: 200 } }),

            ...createHeader("EXPERIENCIA"),
            ...cv.exp.flatMap(e => [
                new Paragraph({ children: [new TextRun({ text: `${e.emp.toUpperCase()} | ${e.car}`, bold: true, size: 22 })], spacing: { before: 200 } }),
                new Paragraph({ children: [new TextRun({ text: e.periodo, italic: true, size: 18 })] }),
                new Paragraph({ children: [new TextRun({ text: e.tar, size: 20 })], spacing: { after: 100 } })
            ]),

            ...createHeader("EDUCACI√ìN"),
            ...cv.edu.flatMap(e => [
                new Paragraph({ children: [new TextRun({ text: `${e.tit} ‚Äî ${e.uni} (${e.fec})`, bold: true, size: 21 })], spacing: { after: 150 } })
            ])
        ];

        for (const base64 of cv.anexos) {
            children.push(new Paragraph({ children: [new PageBreak()] }));
            const resp = await fetch(base64);
            const blob = await resp.blob();
            children.push(new Paragraph({ children: [new ImageRun({ data: blob, transformation: { width: 550, height: 750 } })], alignment: AlignmentType.CENTER }));
        }

        const doc = new Document({ sections: [{ children }] });
        Packer.toBlob(doc).then(blob => { saveAs(blob, "CV_Identidad.docx"); Swal.fire('¬°√âxito!', 'Word descargado', 'success'); });
    }

    function createHeader(t) {
        return [new Paragraph({ children: [new TextRun({ text: t, bold: true, size: 24, color: "007AFF" })], border: { bottom: { color: "007AFF", style: BorderStyle.SINGLE, size: 6 } }, spacing: { before: 400, after: 150 } })];
    }

    // --- PDF ---
    function generarPDF() {
        const content = document.getElementById('pdf-content');
        content.innerHTML = `
            <div style="text-align:center">
                <h1 style="margin:0; font-size:28px;">${document.getElementById('nombre').value.toUpperCase()}</h1>
                <p style="margin:5px 0; font-size:14px; color:#555">C.I: ${document.getElementById('cedula').value} | F. Nac: ${document.getElementById('fecha_nacimiento').value}</p>
                <p style="color:#007AFF; font-size:18px; font-weight:bold">${document.getElementById('cargo').value.toUpperCase()}</p>
                <p style="font-size:12px;">${document.getElementById('telefono').value} | ${document.getElementById('email').value} | ${document.getElementById('ubicacion').value}</p>
            </div>
            <div class="pdf-section">Perfil</div><p style="font-size:13px;">${document.getElementById('perfil').value}</p>
            <div class="pdf-section">Experiencia</div>
            ${cv.exp.map(e => `<div style="margin-top:10px"><div style="font-weight:bold">${e.emp} | ${e.car}</div><div style="font-size:11px; font-style:italic">${e.periodo}</div><div style="font-size:12px">${e.tar}</div></div>`).join('')}
            <div class="pdf-section">Educaci√≥n</div>
            ${cv.edu.map(e => `<div style="margin-top:5px; font-weight:bold">${e.tit} ‚Äî ${e.uni} (${e.fec})</div>`).join('')}
            ${cv.anexos.map(img => `<div style="page-break-before: always; text-align:center"><img src="${img}" style="max-width:100%; max-height:900px"></div>`).join('')}
        `;
        document.getElementById('pdf-render').style.display = "block";
        html2pdf().from(content).set({ margin: 10, filename: 'CV_Identidad.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' } }).save().then(() => {
            document.getElementById('pdf-render').style.display = "none";
        });
    }
</script>
</body>
</html>
